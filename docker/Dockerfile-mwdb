FROM python:3.8

RUN curl -sL https://deb.nodesource.com/setup_12.x | bash - && apt install -y nodejs
RUN apt update && apt install -y build-essential libffi-dev libfuzzy-dev postgresql-client libmagic1

COPY mwdb-plugin-karton/ /tmp/mwdb-plugin-karton/
RUN pip install mwdb-core==2.1.2 karton-core==4.0.5 /tmp/mwdb-plugin-karton/

COPY docker/mwdb.ini docker/uwsgi.ini docker/start.sh docker/karton.ini /app/

WORKDIR /app
# Make fresh web build including plugins
RUN mwdb-core configure web
CMD ["/app/start.sh"]
